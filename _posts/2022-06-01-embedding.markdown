---
layout: post
title: å…³äºŽEmbeddingä¸€ç‚¹æ€»ç»“
categories: [æ·±åº¦å­¦ä¹ ]
comments: true
description: åœ¨æ·±åº¦å­¦ä¹ ä¸­æž„å»ºç”¨æˆ·æˆ–è€…ç‰©å“çš„Embeddingæ˜¯å¾ˆå¸¸è§çš„æ“ä½œï¼Œé‚£ä¹ˆEmbeddingæ˜¯ä»€ä¹ˆ?
---

# Embedding
## 1. å‰ç½®
ðŸ’¡ åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæž„å»ºç”¨æˆ·æˆ–è€…ç‰©å“çš„**Embedding**æ˜¯å¾ˆå¸¸è§çš„æ“ä½œï¼Œé‚£ä¹ˆ embeddingæ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠåœ¨å„ç§æ·±åº¦å­¦ä¹ æ¡†æž¶å½“ä¸­æ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿ

## 2. ä»€ä¹ˆæ˜¯Embedding
ðŸ’¡ è¯å‘é‡ï¼Œè‹±æ–‡åå« **Word Embedding**ï¼ŒæŒ‰ç…§å­—é¢çš„æ„æ€ï¼Œåº”è¯¥æ˜¯è¯åµŒå…¥ã€‚è¯´åˆ°è¯å‘é‡ï¼Œé¦–å…ˆæƒ³åˆ°çš„ä¸€èˆ¬éƒ½æ˜¯çš„ **Word2Vec**å°†è¯IDæ˜ å°„ä¸ºå‘é‡ã€‚å¦‚æˆ‘ä»¬çŸ¥é“RNNæ— æ³•ç›´æŽ¥å¤„ç†å•è¯ï¼Œå› æ­¤éœ€è¦é€šè¿‡æŸç§æ–¹æ³•æŠŠå•è¯å˜æˆæ•°å­—å½¢å¼çš„å‘é‡æ‰èƒ½ä½œä¸ºRNNçš„è¾“å…¥ã€‚è¿™ç§æŠŠå•è¯æ˜ å°„åˆ°å‘é‡ç©ºé—´ä¸­çš„ä¸€ä¸ªå‘é‡çš„åšæ³•ç§°ä¸ºè¯åµŒå…¥word embeddingï¼Œå¯¹åº”çš„å‘é‡ç§°ä¸ºè¯å‘é‡word vectorã€‚

æˆ‘ä»¬çŸ¥é“**one hotåž‹çš„çŸ©é˜µç›¸ä¹˜ï¼Œå°±åƒæ˜¯ç›¸å½“äºŽæŸ¥è¡¨**ï¼ŒäºŽæ˜¯ embedding å®ƒç›´æŽ¥ç”¨æŸ¥è¡¨ä½œä¸ºæ“ä½œï¼Œè€Œä¸å†™æˆçŸ©é˜µå†è¿ç®—ï¼Œè¿™å¤§å¤§é™ä½Žäº†è¿ç®—é‡ã€‚å†å¾—åˆ°äº†å…¨è¿žæŽ¥å±‚çš„å‚æ•°ä¹‹åŽï¼Œç›´æŽ¥ç”¨è¿™ä¸ªå…¨è¿žæŽ¥å±‚çš„å‚æ•°ä½œä¸ºç‰¹å¾ï¼Œæˆ–è€…ç”¨è¿™ä¸ªå…¨è¿žæŽ¥å±‚çš„å‚æ•°ä½œä¸ºå­—ã€è¯çš„è¡¨ç¤ºï¼Œä»Žè€Œå¾—åˆ°äº†å­—ã€è¯å‘é‡ã€‚åŒæ—¶èƒ½å¤Ÿå‘çŽ°äº†ä¸€äº›æœ‰è¶£çš„æ€§è´¨ï¼Œæ¯”å¦‚å‘é‡çš„æ¬§æ°è·ç¦»ã€å¤¹è§’ä½™å¼¦èƒ½å¤Ÿåœ¨æŸç§ç¨‹åº¦ä¸Šè¡¨ç¤ºå­—ã€è¯çš„ç›¸ä¼¼åº¦ã€‚

é‚£ä¸ºä»€ä¹ˆè¿™äº›å­—è¯å‘é‡ä¼šæœ‰è¿™æ ·ä¸€äº›æ€§è´¨å‘¢ï¼Ÿ
å› ä¸ºï¼Œæˆ‘ä»¬åœ¨ç”¨è¯­è¨€æ¨¡åž‹æ— ç›‘ç£è®­ç»ƒæ—¶ï¼Œæ˜¯å¼€äº†çª—å£çš„ï¼Œé€šè¿‡å‰Nä¸ªå­—é¢„æµ‹ä¸‹ä¸€ä¸ªå­—çš„æ¦‚çŽ‡ï¼Œè¿™ä¸ªNå°±æ˜¯çª—å£çš„å¤§å°ï¼ŒåŒä¸€ä¸ªçª—å£å†…çš„è¯è¯­ï¼Œä¼šæœ‰ç›¸ä¼¼çš„æ›´æ–°ï¼Œè¿™äº›æ›´æ–°ä¼šç´¯ç§¯ï¼Œè€Œå…·æœ‰ç›¸ä¼¼æ¨¡å¼çš„è¯è¯­å°±ä¼šæŠŠè¿™äº›ç›¸ä¼¼æ›´æ–°ç´¯ç§¯åˆ°å¯è§‚çš„ç¨‹åº¦ã€‚

## 3. Embeddingå±‚åŸºç¡€ä½¿ç”¨ä¸Žç†è§£
ðŸ’¡ åœ¨pytorchã€Kerasã€paddlepaddleä¹‹ç±»çš„æ¡†æž¶æœ‰ä¸€ä¸ªEmbeddingå±‚ã€‚è¿™é‡Œä»¥pytorchå½“ä¸­çš„embeddingå±‚ä¸ºä¾‹ï¼š
`torch.nn.Embedding`
å…³äºŽtorch.nn.Embeddingçš„ç†è§£ï¼ŒåŸºç¡€çš„å‚æ•°æœ‰ä¸¤ä¸ªï¼ˆnum_embeddings, embedding_dimï¼‰
num_embeddingsä»£è¡¨ä¸€å…±æœ‰å¤šå°‘ä¸ªè¯, embedding_dimä»£è¡¨ä½ æƒ³è¦ä¸ºæ¯ä¸ªè¯åˆ›å»ºä¸€ä¸ªå¤šå°‘ç»´çš„å‘é‡æ¥è¡¨ç¤ºå®ƒã€‚

`import torch`
`from torch import nn`
`torch.manual_seed(0)`
`emb = nn.Embedding(10, 3)`
`emb.weight`
Embeddingå±‚ä¸­åªæœ‰ä¸€ä¸ªå‚æ•° weightï¼Œåœ¨åˆ›å»ºæ—¶å®ƒä¼šä»Žæ ‡å‡†æ­£æ€åˆ†å¸ƒä¸­è¿›è¡Œåˆå§‹åŒ–.

å…¶ä¸­å…¨éƒ¨å‚æ•°:num_embeddings, embedding_dim, padding_idx=None, max_norm=None, norm_type=2.0, scale_grad_by_freq=False, sparse=False, _weight=None, _freeze=False, device=None, dtype=None å‚è€ƒå®˜æ–¹æ–‡æ¡£

**nn.Embedding ä¸Ž nn.Linear** åŒºåˆ«åœ¨äºŽ 
1. nn.Linear æŽ¥å—å‘é‡ä½œä¸ºè¾“å…¥ï¼Œè€Œ nn.Embedding åˆ™æ˜¯æŽ¥å—ç¦»æ•£çš„ç´¢å¼•ä½œä¸ºè¾“å…¥ï¼›
2. nn.Embedding å®žé™…ä¸Šå°±æ˜¯è¾“å…¥ä¸º one-hot å‘é‡ï¼Œä¸”ä¸å¸¦bias çš„ nn.Linearã€‚
3. nn.Linear åœ¨è¿ç®—è¿‡ç¨‹ä¸­åšäº†çŸ©é˜µä¹˜æ³•ï¼Œè€Œ nn.Embedding æ˜¯ç›´æŽ¥æ ¹æ®ç´¢å¼•æŸ¥è¡¨ï¼Œå› æ­¤åœ¨è¯¥æƒ…æ™¯ä¸‹ nn.Embedding çš„æ•ˆçŽ‡æ˜¾ç„¶æ›´é«˜ã€‚



## 4. Embeddingå±‚æ›´æ–°é—®é¢˜
ðŸ’¡ nn.Embedding çš„æƒé‡å®žé™…ä¸Šå°±æ˜¯è¯åµŒå…¥æœ¬èº«
nn.Embedding.weight åœ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­æ—¢æ²¡æœ‰é‡‡ç”¨ Skip-gram ä¹Ÿæ²¡æœ‰é‡‡ç”¨ CBOWã€‚
å¯ä»¥ç®€å•æŠŠ nn.Embedding è§†ä¸ºä¸€ä¸ªç‰¹æ®Šçš„ nn.Linear åŽï¼Œå…¶æ›´æ–°æœºåˆ¶å°±å¾ˆå¥½ç†è§£äº†ï¼ŒåŒæ ·å°±æ˜¯æŒ‰ç…§æ¢¯åº¦è¿›è¡Œæ›´æ–°ç½¢äº†ã€‚è®­ç»ƒç»“æŸåŽï¼Œå¾—åˆ°çš„è¯åµŒå…¥æ˜¯æœ€é€‚åˆå½“å‰ä»»åŠ¡çš„è¯åµŒå…¥ï¼Œè€Œéžåƒ**word2vecï¼ŒGloVe**è¿™ç§æ›´ä¸ºé€šç”¨çš„è¯åµŒå…¥ã€‚å½“ä¸æƒ³è®©å‘é‡åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªæˆ‘æ›´æ–°ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•å†»ç»“æ¢¯åº¦ï¼Œå³ï¼š
`emb.weight.requires_grad = False`



### 5. é˜…è¯»æ–‡æ¡£
> 1. https://pytorch.org/docs/stable/generated/torch.nn.Embedding.html#torch.nn.Embedding
> <br>
> 2. https://stackoverflow.com/questions/65445174/what-is-the-difference-between-an-embedding-layer-with-a-bias-immediately-afterw/65448744#65448744
><br>
>3. https://stackoverflow.com/questions/50747947/embedding-in-pytorch
> <br> 